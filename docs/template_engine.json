{
  "form_builder": {
    "name": "OH eHR Form Builder",
    "description": "Dynamic form builder for creating and managing occupational health form templates",
    "screen": "oh_form_templates.form_builder_modal",
    "layout": "three_panel",
    "components": {
      "left_panel": {
        "type": "drag_source_panel",
        "title": "Form Elements",
        "elements": [
          { "type": "text_input", "label": "Text Input", "icon": "üìù", "schema_type": "string" },
          { "type": "number_input", "label": "Number Input", "icon": "üî¢", "schema_type": "number" },
          { "type": "textarea", "label": "Textarea", "icon": "üìÑ", "schema_type": "string" },
          { "type": "select", "label": "Select", "icon": "üìã", "schema_type": "string" },
          { "type": "multi_select", "label": "Multi Select", "icon": "‚òëÔ∏è", "schema_type": "array" },
          { "type": "checkbox", "label": "Checkbox", "icon": "‚úÖ", "schema_type": "array" },
          { "type": "radio_group", "label": "Radio Group", "icon": "üîò", "schema_type": "string" },
          { "type": "date_picker", "label": "Date Picker", "icon": "üìÖ", "schema_type": "string", "format": "date" },
          { "type": "file_upload", "label": "File Upload", "icon": "üìé", "schema_type": "string", "format": "binary" },
          { "type": "section_divider", "label": "Section Divider", "icon": "‚ûñ", "schema_type": "object", "purpose": "visual_separator" },
          { "type": "signature", "label": "Signature", "icon": "‚úçÔ∏è", "schema_type": "string", "format": "signature" },
          { "type": "horizontal_layout", "label": "Horizontal Layout", "icon": "‚ÜîÔ∏è", "schema_type": "object", "container": true },
          { "type": "vertical_layout", "label": "Vertical Layout", "icon": "‚ÜïÔ∏è", "schema_type": "object", "container": true }
        ],
        "drag_library": "react-dnd",
        "accessibility": {
          "aria_label": "Form elements panel",
          "keyboard_support": true
        }
      },
      "middle_panel": {
        "type": "drop_target_canvas",
        "title": "Form Canvas",
        "droppable": true,
        "render_engine": "react",
        "components": "{{current_form_components}}",
        "features": {
          "multi_page_support": true,
          "page_navigation": true,
          "smart_drop_zones": true,
          "position_indicators": ["left", "right", "top", "bottom"],
          "layout_containers": true,
          "grid_system": "12_column",
          "undo_redo": true
        },
        "actions": {
          "on_drop": "add_component_to_form",
          "on_drop_with_position": "insert_component_at_position",
          "on_select": "select_component_for_properties",
          "reorder": "reorder_components",
          "delete": "delete_component",
          "move_to_page": "move_component_between_pages",
          "create_page": "add_new_page",
          "delete_page": "remove_page",
          "rename_page": "update_page_title"
        },
        "accessibility": {
          "aria_label": "Form canvas",
          "keyboard_support": true,
          "screen_reader_support": true,
          "wcag_compliance": "2.1_AA"
        }
      },
      "right_panel": {
        "type": "properties_editor",
        "title": "Component Properties",
        "condition": "selected_component != null",
        "form": {
          "label": { "type": "input", "label": "Label", "value": "{{selected_component.label}}", "on_change": "update_property" },
          "required": { "type": "checkbox", "label": "Required", "value": "{{selected_component.required}}", "on_change": "update_property" },
          "placeholder": {
            "type": "input",
            "label": "Placeholder",
            "value": "{{selected_component.placeholder}}",
            "condition": "selected_component.type in ['text_input', 'textarea']",
            "on_change": "update_property"
          },
          "options": {
            "type": "dynamic_list",
            "label": "Options",
            "value": "{{selected_component.options}}",
            "condition": "selected_component.type in ['select', 'radio_group', 'checkbox']",
            "on_change": "update_property"
          },
          "validation": {
            "type": "select",
            "label": "Validation Type",
            "options": ["none", "email", "number", "custom"],
            "value": "{{selected_component.validation}}",
            "on_change": "update_property"
          },
          "custom_validation": {
            "type": "input",
            "label": "Custom Regex",
            "value": "{{selected_component.customValidation}}",
            "condition": "selected_component.validation == 'custom'",
            "on_change": "update_property"
          },
          "min_max_values": {
            "type": "group",
            "condition": "selected_component.type in ['number_input', 'text_input', 'textarea']",
            "fields": {
              "min": { "type": "number", "label": "Minimum", "value": "{{selected_component.min}}" },
              "max": { "type": "number", "label": "Maximum", "value": "{{selected_component.max}}" },
              "step": { "type": "number", "label": "Step", "value": "{{selected_component.step}}", "condition": "selected_component.type == 'number_input'" }
            }
          },
          "layout_settings": {
            "type": "group",
            "label": "Layout",
            "fields": {
              "width": { "type": "select", "label": "Width", "options": ["auto", "25%", "33%", "50%", "66%", "75%", "100%"] },
              "alignment": { "type": "select", "label": "Alignment", "options": ["left", "center", "right"] }
            }
          },
          "advanced_settings": {
            "type": "group",
            "label": "Advanced",
            "fields": {
              "field_id": { "type": "input", "label": "Field ID", "value": "{{selected_component.fieldId}}", "readonly": true },
              "description": { "type": "textarea", "label": "Description", "value": "{{selected_component.description}}" },
              "help_text": { "type": "input", "label": "Help Text", "value": "{{selected_component.helpText}}" },
              "default_value": { "type": "input", "label": "Default Value", "value": "{{selected_component.defaultValue}}" }
            }
          }
        },
        "accessibility": {
          "aria_label": "Component properties editor",
          "keyboard_support": true
        }
      }
    },
    "actions": {
      "save_template": {
        "type": "button",
        "label": "Save Template",
        "action": "save_form_as_json",
        "style": "primary",
        "service": "document",
        "endpoint": "/forms/templates",
        "method": "POST",
        "data_format": "headless_json",
        "description": "Saves form template with JSON schema",
        "features": ["auto_schema_generation", "template_versioning", "duplicate_detection"]
      },
      "preview_form": {
        "type": "button",
        "label": "Preview Form",
        "action": "preview_form",
        "style": "secondary",
        "description": "Renders form preview in a modal",
        "features": ["multi_page_preview", "real_time_validation", "responsive_design"]
      },
      "export_json": {
        "type": "button",
        "label": "Export JSON",
        "action": "export_template_json",
        "style": "secondary",
        "description": "Exports form template as JSON file"
      },
      "clear_all": {
        "type": "button",
        "label": "Clear All",
        "action": "clear_form_with_confirmation",
        "style": "danger",
        "description": "Clears all form components with confirmation"
      },
      "undo_redo": {
        "type": "button_group",
        "buttons": [
          { "label": "Undo", "action": "undo_last_action", "shortcut": "Ctrl+Z" },
          { "label": "Redo", "action": "redo_last_action", "shortcut": "Ctrl+Y" }
        ]
      },
      "template_management": {
        "type": "button_group",
        "buttons": [
          { "label": "Template List", "action": "show_template_list", "description": "View all saved templates" },
          { "label": "Create New", "action": "create_new_template", "description": "Start with empty template" }
        ]
      }
    }
  },
  "template_engine": {
    "name": "OH eHR Template Engine",
    "description": "Manages form templates and validates submissions using JSON schema",
    "functionalities": {
      "schema_generation": {
        "description": "Generate JSON schema from form structure",
        "input": "FormTemplate.fields",
        "output": "FormTemplate.jsonSchema",
        "mappings": [
          { "type": "text_input", "schema": "{ type: 'string' }" },
          { "type": "number_input", "schema": "{ type: 'number' }" },
          { "type": "textarea", "schema": "{ type: 'string' }" },
          { "type": "select", "schema": "{ type: 'string', enum: options }" },
          { "type": "multi_select", "schema": "{ type: 'array', items: { type: 'string', enum: options } }" },
          { "type": "checkbox", "schema": "{ type: 'array', items: { type: 'string' } }" },
          { "type": "radio_group", "schema": "{ type: 'string', enum: options }" },
          { "type": "date_picker", "schema": "{ type: 'string', format: 'date' }" },
          { "type": "file_upload", "schema": "{ type: 'string', format: 'binary' }" },
          { "type": "section_divider", "schema": "{ type: 'object', properties: { title: { type: 'string' }, description: { type: 'string' } } }" },
          { "type": "signature", "schema": "{ type: 'string', format: 'signature' }" },
          { "type": "horizontal_layout", "schema": "{ type: 'object', properties: { children: { type: 'array' } } }" },
          { "type": "vertical_layout", "schema": "{ type: 'object', properties: { children: { type: 'array' } } }" },
          { "required": true, "schema_addition": "{ required: [fieldId] }" },
          { "validation": "email", "schema_addition": "{ format: 'email' }" },
          { "validation": "number", "schema_addition": "{ type: 'number' }" },
          { "validation": "custom", "schema_addition": "{ pattern: customValidation }" },
          { "min_max": true, "schema_addition": "{ minimum: min, maximum: max }" }
        ]
      },
      "form_rendering": {
        "description": "Render form from JSON schema in fill modal",
        "screen": "oh_forms.fill_modal, manager_forms.fill_modal",
        "endpoint": "/forms/schema/{templateId}",
        "method": "GET",
        "render_engine": "react-json-schema-form",
        "components": "nhsuk-form-group"
      },
      "validation": {
        "description": "Validate form submission against JSON schema",
        "action": "submit_form_with_validation",
        "endpoint": "/forms/submit",
        "method": "POST",
        "pre_action": "unmarshal_data_and_validate_schema",
        "post_action": "marshal_submission_data",
        "validator": "ajv",
        "error_display": "nhsuk-error-message"
      },
      "workflow_integration": {
        "description": "Integrate with form_management workflow",
        "steps": [
          { "action": "create_template", "endpoint": "/forms/templates", "next": "assign_template" },
          { "action": "assign_template", "endpoint": "/forms/assign", "services": ["document", "notification"] },
          { "action": "submit_form", "endpoint": "/forms/submit", "services": ["document"] },
          { "action": "approve_or_reject", "endpoint": "/forms/approve or /forms/reject", "services": ["document", "notification"] }
        ]
      }
    },
    "dtos": {
      "FormField": {
        "fieldId": "string",
        "label": "string | null",
        "type": "text_input | number_input | textarea | select | multi_select | checkbox | radio_group | date_picker | file_upload | section_divider | signature | horizontal_layout | vertical_layout",
        "required": "boolean",
        "placeholder": "string | null",
        "options": "string[] | null",
        "validation": "none | email | number | custom",
        "customValidation": "string | null",
        "min": "number | null",
        "max": "number | null",
        "step": "number | null",
        "description": "string | null",
        "helpText": "string | null",
        "defaultValue": "string | null",
        "acceptedFileTypes": "string | null",
        "layout": {
          "width": "string | null",
          "height": "string | null",
          "direction": "horizontal | vertical | null",
          "alignment": "start | center | end | null",
          "gap": "small | medium | large | null"
        },
        "children": "FormField[] | null"
      },
      "FormTemplate": {
        "templateId": "string",
        "name": "string",
        "type": "assessment | survey | application | feedback | registration | other",
        "createdDate": "string",
        "fields": "FormField[]",
        "pages": "FormPage[] | null",
        "jsonSchema": "{ type: 'object', properties: { [fieldId: string]: { type: string, required: boolean, format?: string, enum?: string[], pattern?: string, minimum?: number, maximum?: number } }, required: string[] }",
        "description": "string | null"
      },
      "FormPage": {
        "id": "string",
        "title": "string",
        "components": "FormField[]",
        "description": "string | null"
      },
      "FormInstance": {
        "formId": "string",
        "templateId": "string",
        "name": "string",
        "status": "draft | submitted | approved | rejected",
        "data": "{ [fieldId: string]: any }",
        "assignedTo": "string | null"
      },
      "EnhancedFormDTO": {
        "template": "FormTemplate",
        "instances": "FormInstance[]",
        "workflow": {
          "currentStep": "number",
          "totalSteps": "number",
          "approvalChain": "string[]",
          "notifications": "{ recipient: string; trigger: string }[]"
        },
        "validation": {
          "rules": "{ fieldId: string; rule: string; message: string }[]",
          "errors": "{ [fieldId: string]: string }"
        }
      }
    }
  },
  "security": {
    "authentication": "JWT",
    "encryption": "AES-256",
    "transport": "TLS 1.3",
    "access_control": "RBAC",
    "audit_logging": {
      "service": "audit",
      "endpoint": "/audit-logs",
      "actions": ["create_template", "assign_template", "submit_form", "approve_form", "reject_form"]
    }
  },
  "accessibility": {
    "standard": "WCAG 2.1 AA",
    "framework": "NHS UK Design System",
    "features": ["keyboard_navigation", "screen_reader_support", "high_contrast"]
  },
  "performance": {
    "optimizations": ["debounce_property_updates", "memoize_components", "lazy_load_schema", "component_consolidation", "smart_re_renders"],
    "undo_redo": {
      "enabled": true,
      "storage": "in_memory",
      "max_history": 50,
      "keyboard_shortcuts": ["Ctrl+Z", "Ctrl+Y"]
    },
    "drag_drop": {
      "library": "react-dnd",
      "features": ["position_indicators", "smart_zones", "visual_feedback", "constraint_validation"]
    }
  },
  "current_implementation_status": {
    "version": "2.0.0-enhanced",
    "features_implemented": [
      "multi_page_forms",
      "13_field_types",
      "layout_containers",
      "smart_drag_drop",
      "position_indicators", 
      "template_management",
      "json_schema_validation",
      "undo_redo_system",
      "real_time_preview",
      "responsive_design",
      "accessibility_compliance",
      "component_consolidation",
      "advanced_properties",
      "keyboard_navigation"
    ],
    "components_consolidated": [
      "InputPreview (replaces TextInputPreview, NumberInputPreview, DatePickerPreview)",
      "Modal atoms (ModalHeader, ModalBody, ModalFooter, ModalOverlay)",
      "ActionButton variants unified"
    ],
    "exceeds_original_spec": [
      "number_input, multi_select, section_divider, signature fields",
      "horizontal_layout, vertical_layout containers",
      "multi_page support with navigation",
      "advanced validation with min/max/step",
      "layout configuration options",
      "template versioning and management",
      "enhanced accessibility features",
      "smart drop zones with position detection"
    ]
  },
  "integration": {
    "services": [
      {
        "name": "document_service",
        "endpoints": [
          { "endpoint": "/forms/templates", "method": "POST/GET/PUT/DELETE" },
          { "endpoint": "/forms/assign", "method": "POST" },
          { "endpoint": "/forms/submit", "method": "POST" },
          { "endpoint": "/forms/schema/{templateId}", "method": "GET" }
        ]
      },
      {
        "name": "notification_service",
        "endpoints": [
          { "endpoint": "/notifications", "method": "POST", "triggers": ["form_assigned", "form_submitted", "form_approved"] }
        ]
      },
      {
        "name": "audit_service",
        "endpoints": [
          { "endpoint": "/audit-logs", "method": "POST/GET" }
        ]
      }
    ]
  }
}